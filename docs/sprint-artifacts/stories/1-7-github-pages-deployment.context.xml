<?xml version="1.0" encoding="UTF-8"?>
<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>7</storyId>
    <title>GitHub Pages Deployment Pipeline</title>
    <status>drafted</status>
    <generatedAt>2025-11-27</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>/workspace/docs/sprint-artifacts/stories/1-7-github-pages-deployment.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a project maintainer</asA>
    <iWant>the Long Weekend Optimizer automatically deployed to GitHub Pages</iWant>
    <soThat>users can access the application publicly and I can demo the working product</soThat>
    <tasks>- Create GitHub Actions workflow file (AC: 1)
  - Set up build stage with npm ci and npm run build
  - Configure deployment stage to push to gh-pages branch
  - Add proper permissions for GitHub Pages deployment
  - Include build error handling and status reporting
- Configure Vite for GitHub Pages deployment (AC: 2, 3)
  - Update vite.config.ts base path if needed for repository-specific deployment
  - Ensure asset paths resolve correctly in GitHub Pages environment
  - Add 404.html for SPA routing fallback if needed
  - Test build output with relative vs absolute paths
- Set up GitHub Pages repository settings (AC: 2)
  - Enable GitHub Pages in repository settings
  - Configure source to deploy from gh-pages branch
  - Set custom domain if required (future enhancement)
  - Verify HTTPS and security settings
- Test production deployment functionality (AC: 3, 4, 5, 6)
  - Deploy staging version to verify functionality
  - Test all core features in production environment
  - Verify localStorage persistence works in deployed app
  - Test responsive design on actual production URL
  - Validate error handling and user feedback in production
- Create deployment documentation (AC: 4)
  - Document build and deployment process
  - Add troubleshooting guide for common issues
  - Create deployment checklist for future updates
  - Document environment-specific considerations
- Add deployment testing to workflow (AC: 4)
  - Include basic smoke tests in deployment workflow
  - Add production environment validation steps
  - Configure deployment success/failure notifications
  - Test rollback procedures if needed</tasks>
  </story>

  <acceptanceCriteria>1. GitHub Actions workflow automatically builds and deploys on main branch push
2. Application successfully serves from GitHub Pages URL
3. All static assets load correctly in production environment
4. Deployment process includes proper build optimization and error handling
5. Local storage functionality works in deployed environment
6. Responsive design functions correctly on production hosting</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/architecture.md" title="Long Weekend Optimizer - Architecture Documentation" section="Deployment Strategy" snippet="The application follows a pure static site architecture with GitHub Pages configuration including build output to /dist directory, source from main branch, automatic deployment on commit, zero-cost static hosting with HTTPS, and SPA routing via 404.html fallback." />
      <doc path="docs/architecture.md" title="Long Weekend Optimizer - Architecture Documentation" section="CI/CD Pipeline" snippet="GitHub Actions Workflow (.github/workflows/deploy.yml): Trigger on push to main branch, build with npm ci &amp;&amp; npm run build, deploy to gh-pages branch, resulting in automatic production deployment." />
      <doc path="docs/architecture.md" title="Long Weekend Optimizer - Architecture Documentation" section="Environment Configuration" snippet="Production configuration includes optimized static assets, minified bundles, proper asset path resolution, and SPA routing safety." />
      <doc path="docs/prd/epic-1-foundation-core-functionality.md" title="Epic 1: Foundation &amp; Core Functionality" section="Epic Context" snippet="This epic covers the entire MVP. It will establish the project, allow users to input and manage their holidays, and provide the core value by recommending long weekends." />
    </docs>
    <code>
      <artifact path="package.json" kind="build-config" symbol="build" lines="8" reason="Contains the essential npm run build script that creates optimized /dist folder for deployment" />
      <artifact path="package.json" kind="dependency-manifest" symbol="dependencies" lines="16-40" reason="Defines all required dependencies for the React application including Vite build system and testing frameworks" />
      <artifact path="vite.config.ts" kind="build-config" symbol="defineConfig" lines="5-15" reason="Core Vite configuration with React plugin, build output to dist directory, and source maps enabled" />
      <artifact path="src/App.tsx" kind="component" symbol="App" lines="1" reason="Root application component that must work correctly in deployed environment" />
      <artifact path="src/main.tsx" kind="entry-point" symbol="main" lines="1" reason="Application entry point that must load correctly in GitHub Pages environment" />
      <artifact path="src/services/localStorageService.ts" kind="service" symbol="localStorageService" lines="1" reason="Critical for AC5 - localStorage functionality must work in deployed environment" />
      <artifact path="src/components/ErrorBoundary.tsx" kind="component" symbol="ErrorBoundary" lines="1" reason="Essential for AC4 - proper error handling in production environment" />
      <artifact path="src/components/Notification.tsx" kind="component" symbol="Notification" lines="1" reason="Part of user feedback system that must work in production deployment" />
    </code>
    <dependencies>
      <ecosystem name="Node.js">
        <package name="react" version="^18.2.0" />
        <package name="react-dom" version="^18.2.0" />
      </ecosystem>
      <ecosystem name="Build Tools">
        <package name="vite" version="^5.2.0" />
        <package name="@vitejs/plugin-react" version="^4.2.1" />
        <package name="typescript" version="^5.2.2" />
      </ecosystem>
      <ecosystem name="Testing">
        <package name="vitest" version="^1.4.0" />
        <package name="@testing-library/react" version="^14.2.1" />
        <package name="jsdom" version="^24.0.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Must use GitHub Pages static hosting - no server-side dependencies allowed</constraint>
    <constraint>Application must build to /dist directory using existing npm run build command</constraint>
    <constraint>SPA routing requires 404.html fallback for proper navigation</constraint>
    <constraint>Asset paths must resolve correctly in GitHub Pages subdirectory structure</constraint>
    <constraint>localStorage functionality must work in deployed HTTPS environment</constraint>
    <constraint>All existing functionality from stories 1.1-1.6 must remain working</constraint>
    <constraint>Deployment must be automatic on main branch push via GitHub Actions</constraint>
    <constraint>No API keys or secrets can be embedded in client-side code</constraint>
  </constraints>

  <interfaces>
    <interface name="GitHub Actions API" kind="CI/CD" signature="on: push: branches: [ main ]" path=".github/workflows/deploy.yml" />
    <interface name="GitHub Pages Deployment" kind="Static Hosting" signature="gh-pages branch serving" path="Repository Settings &gt; Pages" />
    <interface name="Vite Build System" kind="Build Tool" signature="npm run build" path="package.json" />
    <interface name="localStorage API" kind="Browser Storage" signature="localStorage.getItem/setItem/removeItem" path="src/services/localStorageService.ts" />
  </interfaces>

  <tests>
    <standards>Testing uses Vitest framework with React Testing Library for component testing. Tests are located in src/components/__tests__/ directories with comprehensive coverage including edge cases and integration tests. All tests must pass before deployment.</standards>
    <locations>src/components/__tests__/, npm run test, npm run test:coverage</locations>
    <ideas>
      <test idea="smoke-test-build" target="AC1,2">Verify GitHub Actions workflow executes and build completes without errors</test>
      <test idea="production-loading" target="AC2,3">Test application loads correctly from GitHub Pages URL with all assets</test>
      <test idea="localstorage-production" target="AC5">Verify localStorage persistence works in deployed HTTPS environment</test>
      <test idea="responsive-production" target="AC6">Test responsive design on actual GitHub Pages hosting</test>
      <test idea="error-handling-production" target="AC4">Validate error boundaries and notifications work in production</test>
      <test idea="spa-routing-fallback" target="SPA functionality">Test 404.html fallback works for direct navigation</test>
    </ideas>
  </tests>
</story-context>